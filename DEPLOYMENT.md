# üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ PK Online Bot

## üìã –û–±–∑–æ—Ä

PK Online Bot –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –∫–∞–∫ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π PostgreSQL –ë–î (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏), —Ç–∞–∫ –∏ —Å –≤–Ω–µ—à–Ω–µ–π –ë–î (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞).

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- PostgreSQL –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Docker volume

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω
- –í–Ω–µ—à–Ω—è—è PostgreSQL –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, AWS RDS, Google Cloud SQL, etc.)
- –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –≤–Ω–µ—à–Ω–µ–π –ë–î —á–µ—Ä–µ–∑ SSL
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±—ç–∫–∞–ø–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd pkonline-bot

# –°–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª
cp env.production.example .env
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º .env —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

# –ó–∞–ø—É—Å–∫–∞–µ–º
docker-compose up -d
```

### 2. –ü—Ä–æ–¥–∞–∫—à–µ–Ω —Å –≤–Ω–µ—à–Ω–µ–π –ë–î

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd pkonline-bot

# –°–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
cp env.production.example .env
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º .env —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤–Ω–µ—à–Ω–µ–π –ë–î

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å –≤–Ω–µ—à–Ω–µ–π –ë–î
docker-compose -f docker-compose.prod.yml up -d
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `ADMIN_CHAT_ID` - ID –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ —á–∞—Ç–∞
- `ADMIN_USER_ID` - ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
- `USE_EXTERNAL_DB` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω—é—é –ë–î (true/false)
- `EXTERNAL_DB_HOST` - —Ö–æ—Å—Ç –≤–Ω–µ—à–Ω–µ–π –ë–î
- `EXTERNAL_DB_PORT` - –ø–æ—Ä—Ç –ë–î (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5432)
- `EXTERNAL_DB_NAME` - –∏–º—è –ë–î
- `EXTERNAL_DB_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
- `EXTERNAL_DB_PASSWORD` - –ø–∞—Ä–æ–ª—å –ë–î
- `EXTERNAL_DB_SSL` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSL (true/false)

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `GENERAL_CHAT_ID` - ID –æ–±—â–µ–≥–æ —á–∞—Ç–∞ –¥–ª—è –ª–æ–≥–æ–≤
- `ADMIN_LOG_CHAT_ID` - ID –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ —á–∞—Ç–∞ –¥–ª—è –æ—à–∏–±–æ–∫
- `THREAD_*` - ID —Ç—Ä–µ–¥–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π

### –ü—Ä–∏–º–µ—Ä .env —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

```env
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
BOT_TOKEN=your-telegram-bot-token
ADMIN_CHAT_ID=123456789
ADMIN_USER_ID=123456789

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–Ω–µ—à–Ω–µ–π –ë–î
USE_EXTERNAL_DB=true
EXTERNAL_DB_HOST=your-db-host.com
EXTERNAL_DB_PORT=5432
EXTERNAL_DB_NAME=pkonline_prod
EXTERNAL_DB_USER=your_user
EXTERNAL_DB_PASSWORD=your_password
EXTERNAL_DB_SSL=true

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–æ–≤
GENERAL_CHAT_ID=0
ADMIN_LOG_CHAT_ID=0
```

## üîß –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞

### –° —Ñ–ª–∞–≥–∞–º–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î
python bot.py

# –í–Ω–µ—à–Ω—è—è –ë–î
python bot.py --external-db \
    --db-host your-host.com \
    --db-port 5432 \
    --db-name your_db \
    --db-user your_user \
    --db-password your_password \
    --db-ssl
```

### –ß–µ—Ä–µ–∑ Docker

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
docker-compose up -d

# –ü—Ä–æ–¥–∞–∫—à–µ–Ω
docker-compose -f docker-compose.prod.yml up -d
```

## üíæ –ë—ç–∫–∞–ø—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –ó–∞–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω—Å–∫–æ–µ –º–µ–Ω—é –±–æ—Ç–∞
2. –í—ã–±–µ—Ä–∏—Ç–µ "üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—è–º–∏"
3. –ù–∞–∂–º–∏—Ç–µ "üíæ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î"
4. –ü–æ–ª—É—á–∏—Ç–µ SQL —Ñ–∞–π–ª —Å –±—ç–∫–∞–ø–æ–º

### –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –≤—Ä—É—á–Ω—É—é

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–µ–π –ë–î
pg_dump -h your-host.com -p 5432 -U your_user -d your_db > backup.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
psql -h your-host.com -p 5432 -U your_user -d your_db < backup.sql
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –±–æ—Ç–∞
docker-compose logs -f bot

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ë–î (–ª–æ–∫–∞–ª—å–Ω–∞—è)
docker-compose logs -f db
```

### –°—Ç–∞—Ç—É—Å

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
docker-compose exec bot pg_isready -h $EXTERNAL_DB_HOST -p $EXTERNAL_DB_PORT -U $EXTERNAL_DB_USER
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ .env
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞ —Å —Ö–æ—Å—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±—ç–∫–∞–ø–∞–º–∏

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ pg_dump —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ

### –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec bot python -m alembic upgrade head

# –°–±—Ä–æ—Å –º–∏–≥—Ä–∞—Ü–∏–π (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
docker-compose exec bot python -m alembic downgrade base
```

## üìä –û—Ç—á–µ—Ç—ã

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

- üìä –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –¥–µ–Ω—å
- ‚è∞ –û—Ç—á–µ—Ç –ø–æ —Ä–∞–±–æ—á–µ–º—É –≤—Ä–µ–º–µ–Ω–∏ - –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- üìã –û—Ç—á–µ—Ç –ø–æ –∑–∞—è–≤–ª–µ–Ω–∏—è–º - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—á–µ—Ä–µ–¥—è–º
- üìÆ –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–ª–µ–Ω–∏–π –ø–æ—á—Ç—ã - –∑–∞—è–≤–ª–µ–Ω–∏—è, –∂–¥—É—â–∏–µ –æ—Ç–≤–µ—Ç–∞ –±–æ–ª–µ–µ 3 –¥–Ω–µ–π

### –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤

1. –ó–∞–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω—Å–∫–æ–µ –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ "üìä –û—Ç—á–µ—Ç—ã"
3. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ç–∏–ø –æ—Ç—á–µ—Ç–∞

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–µ–π –ë–î
2. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ë–î –ø–æ IP
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
4. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
5. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø—ã

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env —Ñ–∞–π–ª—ã –≤ git
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –†–æ—Ç–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π –ë–î 